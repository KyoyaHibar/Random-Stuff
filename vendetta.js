"use strict";(()=>{var qe=Object.defineProperty;var E=(e,t)=>{for(var o in t)qe(e,o,{get:t[o],enumerable:!0})};var z={};E(z,{after:()=>w,before:()=>Ze,instead:()=>et,unpatchAll:()=>Be});var W=["a","b","i"],S=new Map;function Ce(e,t,o,r,n){let l=S.get(t)?.[e];if(!l)return n?Reflect.construct(t[e],o,r):t[e].apply(r,o);for(let a of l.b.values()){let y=a.call(r,o);Array.isArray(y)&&(o=y)}let c=(...a)=>n?Reflect.construct(l.o,a,r):l.o.apply(r,a);for(let a of l.i.values()){let y=c;c=(...v)=>a.call(r,v,y)}let s=c(...o);for(let a of l.a.values())s=a.call(r,o,s)??s;return s}function K(e,t,o,r){let n=S.get(e),l=n?.[t];return l?.[r].has(o)?(l[r].delete(o),W.every(c=>l[c].size===0)&&(Reflect.defineProperty(e,t,{value:l.o,writable:!0,configurable:!0})||(e[t]=l.o),delete n[t]),Object.keys(n).length==0&&S.delete(e),!0):!1}function Be(){for(let[e,t]of S.entries())for(let o in t)for(let r of W)for(let n of t[o]?.[r].keys()??[])K(e,o,n,r)}var j=e=>(t,o,r,n=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);S.has(o)||S.set(o,{});let l=S.get(o);if(!l[t]){let a=o[t];l[t]={o:a,b:new Map,i:new Map,a:new Map};let y=(b,A,C)=>{let Qe=Ce(t,o,A,b,C);return n&&s(),Qe},v=new Proxy(a,{apply:(b,A,C)=>y(A,C,!1),construct:(b,A)=>y(a,A,!0),get:(b,A,C)=>A=="toString"?a.toString.bind(a):Reflect.get(b,A,C)});Reflect.defineProperty(o,t,{value:v,configurable:!0,writable:!0})||(o[t]=v)}let c=Symbol(),s=()=>K(o,t,c,e);return l[t][e].set(c,r),s};var Ze=j("b"),et=j("i"),w=j("a");var _e={...z};var ee={};E(ee,{filterModules:()=>Q,find:()=>B,findAll:()=>Z,findByDisplayName:()=>$,findByDisplayNameAll:()=>ot,findByProps:()=>p,findByPropsAll:()=>tt,modules:()=>q});function ke(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){ke(t);continue}}var Me=e=>Object.values(window.modules).find(t=>t.publicModule.exports?.[e]).publicModule.exports;window.React=Me("createElement");var X=Me("isMoment"),Q=(e,t=!1)=>o=>{let r=[],n=X?.locale();for(let l in e){let c=Number(l),s=e[c].publicModule.exports;if(!e[c].isInitialized)try{__r(c),n&&n!==X.locale()&&X.locale(n)}catch{}if(!s){ke(c);continue}try{if(s.default&&s.__esModule&&o(s.default)){if(t)return s.default;r.push(s.default)}if(o(s)){if(t)return s;r.push(s)}}catch(a){console.error(`Failed to getModule... ${a.stack||a.toString()}`)}}if(!t)return r},q=window.modules,B=Q(q,!0),Z=Q(q),Le=e=>t=>e.every(o=>t[o]!==void 0),Ve=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,p=(...e)=>B(Le(e)),tt=(...e)=>Z(Le(e)),$=(e,t=!0)=>B(Ve(e,t)),ot=(e,t=!0)=>Z(Ve(e,t));var rt=p("setLogFn").default,nt=new rt("Vendetta"),R=nt;var ie={};E(ie,{AsyncStorage:()=>M,NavigationNative:()=>se,React:()=>it,ReactNative:()=>m,assets:()=>_,channels:()=>st,clipboard:()=>re,constants:()=>te,i18n:()=>G,navigation:()=>k,navigationStack:()=>ne,stylesheet:()=>d,toasts:()=>oe,url:()=>H});var te=p("API_HOST"),st=p("getVoiceChannelId"),G=p("Messages"),H=p("openURL"),oe=B(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),d=p("createThemedStyleSheet"),re=p("setString","getString"),_=p("registerAsset"),k=p("pushLazy"),ne=p("createStackNavigator"),se=p("NavigationContainer"),it=p("createElement"),m=p("Text","Image"),M=p("setItem");function T(e){try{re.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function L(e,t,{walkable:o=[],ignore:r=[],maxDepth:n=100}={}){let l=0;function c(s,a,{walkable:y=[],ignore:v=[]}={}){if(l+=1,!(l>n)){if(typeof a=="string"){if(s.hasOwnProperty(a))return s[a]}else if(a(s))return s;if(!!s){if(Array.isArray(s))for(let D of s){let b=c(D,a,{walkable:y,ignore:v});if(b)return b}else if(typeof s=="object"){for(let D of Object.keys(s))if(!(y!=null&&y.includes(D))&&!v.includes(D))try{let b=c(s[D],a,{walkable:y,ignore:v});if(b)return b}catch{}}}}}return c(e,t,{walkable:o,ignore:r})}function V(e,t){return L(e,t,{walkable:["props","children","child","sibling"]})}var ce={};E(ce,{DISCORD_SERVER:()=>ae,GITHUB:()=>le});var ae="https://discord.gg/n9QQ4XhhJP",le="https://github.com/vendetta-mod";var pe={};E(pe,{Forms:()=>u,General:()=>U});var u=p("Form","FormSection"),U=p("Button","Text","View");var de={};E(de,{showToast:()=>f});function f(e,t){return oe.open({content:e,source:t})}var x={};function me(){try{w("registerAsset",_,(e,t)=>{let o=e[0];x[o.name]={...o,id:t}});for(let e=1;;e++){let t=_.getAssetByID(e);if(!t)break;x[t.name]||(x[t.name]={...t,id:e})}}catch{}}var Ue=e=>Object.values(x).find(e),je=e=>x[e],$e=e=>_.getAssetByID(e),i=e=>x[e]?.id;var{FormRow:I,FormSection:at,FormDivider:Ge}=u;function ue({navigation:e}){return React.createElement(at,{key:"Vendetta",title:"Vendetta"},React.createElement(I,{label:"General",leading:()=>React.createElement(I.Icon,{source:i("settings")}),trailing:I.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(Ge,null),React.createElement(I,{label:"Plugins",leading:()=>React.createElement(I.Icon,{source:i("debug")}),trailing:I.Arrow,onPress:()=>e.push("VendettaPlugins")}),React.createElement(Ge,null),React.createElement(I,{label:"Asset Browser",leading:()=>React.createElement(I.Icon,{source:i("grid")}),trailing:I.Arrow,onPress:()=>e.push("VendettaAssetBrowser")}))}var P,lt=eval;function J(e){if(P!==void 0&&P.readyState!==WebSocket.CLOSED&&P.close(),e===""){f("Invalid debugger URL!",i("Small"));return}P=new WebSocket(`ws://${e}`),P.addEventListener("open",()=>f("Connected to debugger.",i("Check"))),P.addEventListener("message",t=>{try{lt(t.data)}catch(o){console.error(o)}}),P.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),f("An error occurred with the debugger connection!",i("Small"))})}function He(){w("nativeLoggingHook",globalThis,(e,t)=>{P?.readyState===WebSocket.OPEN&&P.send(JSON.stringify({message:e[0],level:e[1]})),R.log(e[0])})}var{FormRow:Je,FormText:ct}=u;function fe({label:e,version:t,icon:o}){return React.createElement(Je,{label:e,leading:()=>React.createElement(Je.Icon,{source:i(o)}),trailing:()=>React.createElement(ct,null,t),onPress:()=>{T(`${e} - ${t}`),f("Copied version to clipboard.",i("toast_copy_link"))}})}var{FormRow:h,FormSection:ge,FormInput:pt,FormDivider:Y}=u,ye=window.HermesInternal.getRuntimeProperties(),he=m.Platform.constants.reactNativeVersion;function be(){let[e,t]=React.useState(""),o=[{label:"Discord",version:m.NativeModules.InfoDictionaryManager.Version,icon:"Discord"},{label:"React",version:React.version,icon:"ic_category_16px"},{label:"React Native",version:`${he.major||0}.${he.minor||0}.${he.patch||0}`,icon:"mobile"},{label:"Hermes",version:`${ye["OSS Release Version"]} ${ye.Build} | Bytecode ${ye["Bytecode Version"]}`,icon:"ic_badge_staff"}];return React.createElement(m.ScrollView,null,React.createElement(ge,{title:"Links"},React.createElement(h,{label:"Discord Server",leading:()=>React.createElement(h.Icon,{source:i("Discord")}),trailing:h.Arrow,onPress:()=>H.openURL(ae)}),React.createElement(Y,null),React.createElement(h,{label:"GitHub",leading:()=>React.createElement(h.Icon,{source:i("img_account_sync_github_white")}),trailing:h.Arrow,onPress:()=>H.openURL(le)})),React.createElement(ge,{title:"Debug"},React.createElement(pt,{value:e,onChange:r=>t(r),title:"DEBUGGER URL"}),React.createElement(Y,null),React.createElement(h,{label:"Connect to debug websocket",leading:()=>React.createElement(h.Icon,{source:i("copy")}),trailing:h.Arrow,onPress:()=>J(e)}),React.createElement(Y,null),React.createElement(h,{label:"Reload Discord",leading:()=>React.createElement(h.Icon,{source:i("ic_message_retry")}),trailing:h.Arrow,onPress:()=>m.NativeModules.BundleUpdaterManager.reload()})),React.createElement(ge,{title:"Versions"},o.map(r=>React.createElement(React.Fragment,null,React.createElement(fe,{label:r.label,version:r.version,icon:r.icon}),React.createElement(Y,null)))))}var Ye={get(e,t){let o=Reflect.get(e,t);return typeof o=="object"&&o!==null?new Proxy(o,Ye):o},set(e,t,o){return Reflect.set(e,t,o),M.setItem("VENDETTA_PLUGINS",JSON.stringify(g)),!0},deleteProperty(e,t){return Reflect.deleteProperty(e,t),M.setItem("VENDETTA_PLUGINS",JSON.stringify(g)),!0}},g=new Proxy({},Ye),N={};async function Se(e){if(e.endsWith("/")||(e+="/"),typeof e!="string"||e in g)throw new Error("Plugin ID invalid or taken");let t;try{t=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let o;try{o=await(await fetch(new URL(t.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(o.length===0)throw new Error(`Failed to fetch JS for ${e}`);g[e]={id:e,manifest:t,enabled:!1,update:!0,js:o}}function dt(e){let t=Object.assign({},window.vendetta),o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,r=(0,eval)(o)(t),n=typeof r=="function"?r():r;return n.default||n}function we(e){let t=g[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=dt(t);N[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){R.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{N[t.id]?.onUnload?.()}catch(r){R.error(`Plugin ${t.id} errored whilst unloading`,r)}delete N[e],t.enabled=!1}}function xe(e){let t=g[e],o=N[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{N[t.id]?.onUnload?.()}catch(r){R.error(`Plugin ${t.id} errored whilst unloading`,r)}delete N[e],t.enabled=!1}function We(e){g[e].enabled&&xe(e),delete g[e]}var Ke=e=>N[e]?.settings,ze=()=>M.getItem("VENDETTA_PLUGINS").then(async function(e){if(!e)return;let t=JSON.parse(e);for(let o of Object.keys(t)){let r=t[o];t[o].update?await Se(r.id):g[o]=t[o],t[o].enabled&&g[o]&&we(o)}});var F=d.createThemedStyleSheet({container:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},card:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:d.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:d.ThemeColorMap.HEADER_PRIMARY},headerTitle:{fontFamily:te.Fonts.PRIMARY_BOLD,color:d.ThemeColorMap.HEADER_PRIMARY},backIcon:{tintColor:d.ThemeColorMap.INTERACTIVE_ACTIVE,marginLeft:15,marginRight:20}}),Xe=ne.createStackNavigator(),{TouchableOpacity:mt,Image:ut}=U;function Re({plugin:e,children:t}){return React.createElement(se.NavigationContainer,null,React.createElement(Xe.Navigator,{initialRouteName:e.manifest.name,style:F.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:F.card,headerStyle:F.header,headerTitleContainerStyle:F.headerTitleContainer}},React.createElement(Xe.Screen,{name:e.manifest.name,component:t,options:{headerTitleStyle:F.headerTitle,headerLeft:()=>React.createElement(mt,{onPress:()=>k.pop()},React.createElement(ut,{style:F.backIcon,source:i("back-icon")}))}})))}var{FormRow:Ie,FormSwitch:ft}=u,{TouchableOpacity:Pe,Image:ve}=U,O=d.createThemedStyleSheet({card:{backgroundColor:d.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:d.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,marginLeft:5,tintColor:d.ThemeColorMap.INTERACTIVE_NORMAL}});function Ae({plugin:e}){let[t,o]=React.useState(e.enabled),[r,n]=React.useState(e.update),[l,c]=React.useState(!1),s=Ke(e.id);return l?React.createElement(React.Fragment,null):React.createElement(m.View,{style:O.card},React.createElement(Ie,{style:O.header,label:`${e.manifest.name} by ${e.manifest.authors.map(a=>a.name).join(", ")}`,leading:React.createElement(Ie.Icon,{source:i(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(ft,{value:e.enabled,onValueChange:a=>{a?we(e.id):xe(e.id),o(a)}})}),React.createElement(Ie,{label:e.manifest.description,trailing:React.createElement(m.View,{style:O.actions},React.createElement(Pe,{onPress:()=>{We(e.id),c(!0)}},React.createElement(ve,{style:O.icon,source:i("ic_message_delete")})),React.createElement(Pe,{onPress:()=>{e.update=!e.update,n(e.update),f(`${e.update?"Enabled":"Disabled"} updates for ${e.manifest.name}.`,i("toast_image_saved"))}},React.createElement(ve,{style:O.icon,source:i(e.update?"Check":"Small")})),s&&React.createElement(Pe,{onPress:()=>{k.push(Re,{plugin:e,children:s})}},React.createElement(ve,{style:O.icon,source:i("settings")})))}))}var{FormInput:gt,FormRow:Te}=u;function Ne(){let[e,t]=React.useState(""),[o,r]=React.useState(g);return React.createElement(React.Fragment,null,React.createElement(gt,{value:e,onChange:n=>t(n),title:"PLUGIN URL"}),React.createElement(Te,{label:"Install plugin",leading:()=>React.createElement(Te.Icon,{source:i("add_white")}),trailing:Te.Arrow,onPress:()=>{Se(e).then(()=>{t(""),r(g)}).catch(n=>{f(n.message,i("Small"))})}}),React.createElement(m.FlatList,{data:Object.values(o),renderItem:({item:n})=>React.createElement(Ae,{plugin:n}),keyExtractor:n=>n.id}))}var{FormRow:yt}=u,ht=d.createThemedStyleSheet({asset:{width:32,height:32}});function De({asset:e}){return React.createElement(yt,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(m.Image,{source:e.id,style:ht.asset}),onPress:()=>{T(e.name),f("Copied asset name to clipboard.",i("toast_copy_link"))}})}var{FormInput:bt,FormDivider:St}=u;function Ee(){let[e,t]=React.useState("");return React.createElement(React.Fragment,null,React.createElement(bt,{value:e,onChange:o=>t(o),title:"SEARCH"}),React.createElement(m.FlatList,{data:Object.values(x).filter(o=>o.name.includes(e)),renderItem:({item:o})=>React.createElement(React.Fragment,null,React.createElement(De,{asset:o}),React.createElement(St,null)),keyExtractor:o=>o.name}))}var wt=$("getScreens",!1),xt=$("UserSettingsOverviewWrapper",!1),Fe=!1;function Oe(){w("default",wt,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:be},VendettaPlugins:{title:"Plugins",render:Ne},VendettaAssetBrowser:{title:"Asset Browser",render:Ee}})),w("default",xt,(e,t)=>{let o=V(t.props.children,r=>r.type&&r.type.name==="UserSettingsOverview");w("renderSupportAndAcknowledgements",o.type.prototype,(r,{props:{children:n}})=>{let l=n.findIndex(c=>c?.type?.name==="UploadLogsButton");l!==-1&&n.splice(l,1)}),w("render",o.type.prototype,(r,{props:{children:n}})=>{let l=[G.Messages.BILLING_SETTINGS,G.Messages.PREMIUM_SETTINGS],c=n.findIndex(s=>l.includes(s.props.title));n.splice(c===-1?4:c,Fe?1:0,React.createElement(ue,{navigation:o.props.navigation})),Fe||(Fe=!0)})})}console.log("Hello from Vendetta!");async function Rt(){let e=!1;try{window.vendetta={patcher:_e,metro:{...ee,common:{...ie}},constants:{...ce},utils:{copyText:T,findInReactTree:V,findInTree:L},debug:{connectToDebugger:J},ui:{components:{...pe},toasts:{...de},assets:{all:x,find:Ue,getAssetByID:$e,getAssetByName:je,getAssetIDByName:i}},logger:R},Oe(),me(),He(),ze()}catch(t){e=!0,alert(`Vendetta failed to initialize... ${t.stack||t.toString()}`)}e||R.log("Vendetta is ready!")}Rt();})();
//# sourceURL=Vendetta
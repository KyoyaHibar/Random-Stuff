"use strict";(()=>{var st=Object.defineProperty;var E=(e,t)=>{for(var o in t)st(e,o,{get:t[o],enumerable:!0})};var oe={};E(oe,{after:()=>x,before:()=>it,instead:()=>at,unpatchAll:()=>Le});var ee=["a","b","i"],w=new Map;function ke(e,t,o,r,n){let l=w.get(t)?.[e];if(!l)return n?Reflect.construct(t[e],o,r):t[e].apply(r,o);for(let a of l.b.values()){let y=a.call(r,o);Array.isArray(y)&&(o=y)}let c=(...a)=>n?Reflect.construct(l.o,a,r):l.o.apply(r,a);for(let a of l.i.values()){let y=c;c=(...I)=>a.call(r,I,y)}let s=c(...o);for(let a of l.a.values())s=a.call(r,o,s)??s;return s}function te(e,t,o,r){let n=w.get(e),l=n?.[t];return l?.[r].has(o)?(l[r].delete(o),ee.every(c=>l[c].size===0)&&(Reflect.defineProperty(e,t,{value:l.o,writable:!0,configurable:!0})||(e[t]=l.o),delete n[t]),Object.keys(n).length==0&&w.delete(e),!0):!1}function Le(){for(let[e,t]of w.entries())for(let o in t)for(let r of ee)for(let n of t[o]?.[r].keys()??[])te(e,o,n,r)}var G=e=>(t,o,r,n=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);w.has(o)||w.set(o,{});let l=w.get(o);if(!l[t]){let a=o[t];l[t]={o:a,b:new Map,i:new Map,a:new Map};let y=(b,v,M)=>{let nt=ke(t,o,v,b,M);return n&&s(),nt},I=new Proxy(a,{apply:(b,v,M)=>y(v,M,!1),construct:(b,v)=>y(a,v,!0),get:(b,v,M)=>v=="toString"?a.toString.bind(a):Reflect.get(b,v,M)});Reflect.defineProperty(o,t,{value:I,configurable:!0,writable:!0})||(o[t]=I)}let c=Symbol(),s=()=>te(o,t,c,e);return l[t][e].set(c,r),s};var it=G("b"),at=G("i"),x=G("a");var Ve={...oe};var ae={};E(ae,{filterModules:()=>ne,find:()=>F,findAll:()=>ie,findByDisplayName:()=>H,findByDisplayNameAll:()=>ct,findByProps:()=>p,findByPropsAll:()=>lt,findByStoreName:()=>J,modules:()=>se});function Ue(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){Ue(t);continue}}var je=e=>Object.values(window.modules).find(t=>t.publicModule.exports?.[e]).publicModule.exports;window.React=je("createElement");var re=je("isMoment"),ne=(e,t=!1)=>o=>{let r=[],n=re?.locale();for(let l in e){let c=Number(l),s=e[c].publicModule.exports;if(!e[c].isInitialized)try{__r(c),n&&n!==re.locale()&&re.locale(n)}catch{}if(!s){Ue(c);continue}try{if(s.default&&s.__esModule&&o(s.default)){if(t)return s.default;r.push(s.default)}if(o(s)){if(t)return s;r.push(s)}}catch(a){console.error(`Failed to getModule... ${a.stack||a.toString()}`)}}if(!t)return r},se=window.modules,F=ne(se,!0),ie=ne(se),$e=e=>t=>e.every(o=>t[o]!==void 0),Ge=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,p=(...e)=>F($e(e)),lt=(...e)=>ie($e(e)),H=(e,t=!0)=>F(Ge(e,t)),ct=(e,t=!0)=>ie(Ge(e,t)),J=e=>F(t=>t.getName?.()===e);var pt=p("setLogFn").default,mt=new pt("Vendetta"),S=mt;var ue={};E(ue,{AsyncStorage:()=>k,Flux:()=>ut,FluxDispatcher:()=>K,NavigationNative:()=>de,React:()=>ft,ReactNative:()=>d,assets:()=>B,channels:()=>dt,clipboard:()=>pe,constants:()=>le,i18n:()=>Y,navigation:()=>C,navigationStack:()=>me,stylesheet:()=>m,toasts:()=>ce,url:()=>W});var le=p("API_HOST"),dt=p("getVoiceChannelId"),Y=p("Messages"),W=p("openURL"),ce=F(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),m=p("createThemedStyleSheet"),pe=p("setString","getString"),B=p("registerAsset"),C=p("pushLazy"),me=p("createStackNavigator"),de=p("NavigationContainer"),ut=p("connectStores"),K=p("_currentDispatchActionType"),ft=p("createElement"),d=p("Text","Image"),k=p("setItem");function A(e){try{pe.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function L(e,t,{walkable:o=[],ignore:r=[],maxDepth:n=100}={}){let l=0;function c(s,a,{walkable:y=[],ignore:I=[]}={}){if(l+=1,!(l>n)){if(typeof a=="string"){if(s.hasOwnProperty(a))return s[a]}else if(a(s))return s;if(!!s){if(Array.isArray(s))for(let N of s){let b=c(N,a,{walkable:y,ignore:I});if(b)return b}else if(typeof s=="object"){for(let N of Object.keys(s))if(!(y!=null&&y.includes(N))&&!I.includes(N))try{let b=c(s[N],a,{walkable:y,ignore:I});if(b)return b}catch{}}}}}return c(e,t,{walkable:o,ignore:r})}function V(e,t){return L(e,t,{walkable:["props","children","child","sibling"]})}var ye={};E(ye,{DISCORD_SERVER:()=>fe,GITHUB:()=>ge});var fe="https://discord.gg/n9QQ4XhhJP",ge="https://github.com/vendetta-mod";var he={};E(he,{Forms:()=>u,General:()=>U});var u=p("Form","FormSection"),U=p("Button","Text","View");var be={};E(be,{showToast:()=>g});function g(e,t){return ce.open({content:e,source:t})}var P={};function He(){try{x("registerAsset",B,(e,t)=>{let o=e[0];P[o.name]={...o,id:t}});for(let e=1;;e++){let t=B.getAssetByID(e);if(!t)break;P[t.name]||(P[t.name]={...t,id:e})}}catch{}}var Je=e=>Object.values(P).find(e),Ye=e=>P[e],We=e=>B.getAssetByID(e),i=e=>P[e]?.id;var{FormRow:R,FormSection:gt,FormDivider:Ke}=u;function Se({navigation:e}){return React.createElement(gt,{key:"Vendetta",title:"Vendetta"},React.createElement(R,{label:"General",leading:()=>React.createElement(R.Icon,{source:i("settings")}),trailing:R.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(Ke,null),React.createElement(R,{label:"Plugins",leading:()=>React.createElement(R.Icon,{source:i("debug")}),trailing:R.Arrow,onPress:()=>e.push("VendettaPlugins")}),React.createElement(Ke,null),React.createElement(R,{label:"Asset Browser",leading:()=>React.createElement(R.Icon,{source:i("grid")}),trailing:R.Arrow,onPress:()=>e.push("VendettaAssetBrowser")}))}var T;function z(e){if(T!==void 0&&T.readyState!==WebSocket.CLOSED&&T.close(),e===""){g("Invalid debugger URL!",i("Small"));return}T=new WebSocket(`ws://${e}`),T.addEventListener("open",()=>g("Connected to debugger.",i("Check"))),T.addEventListener("message",t=>{try{(0,eval)(t.data)}catch(o){console.error(o)}}),T.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),g("An error occurred with the debugger connection!",i("Small"))})}function ze(){x("nativeLoggingHook",globalThis,(e,t)=>{T?.readyState===WebSocket.OPEN&&T.send(JSON.stringify({message:e[0],level:e[1]})),S.log(e[0])})}var{FormRow:Xe,FormText:yt}=u;function we({label:e,version:t,icon:o}){return React.createElement(Xe,{label:e,leading:()=>React.createElement(Xe.Icon,{source:i(o)}),trailing:()=>React.createElement(yt,null,t),onPress:()=>{A(`${e} - ${t}`),g("Copied version to clipboard.",i("toast_copy_link"))}})}var{FormRow:h,FormSection:xe,FormInput:ht,FormDivider:X}=u,Qe=d.NativeModules.InfoDictionaryManager,Pe=window.HermesInternal.getRuntimeProperties(),Re=d.Platform.constants.reactNativeVersion;function Te(){let[e,t]=React.useState(""),o=[{label:"Discord",version:`${Qe.Version} (${Qe.Build})`,icon:"Discord"},{label:"React",version:React.version,icon:"ic_category_16px"},{label:"React Native",version:`${Re.major||0}.${Re.minor||0}.${Re.patch||0}`,icon:"mobile"},{label:"Hermes",version:`${Pe["OSS Release Version"]} ${Pe.Build} | Bytecode ${Pe["Bytecode Version"]}`,icon:"ic_badge_staff"}];return React.createElement(d.ScrollView,null,React.createElement(xe,{title:"Links"},React.createElement(h,{label:"Discord Server",leading:()=>React.createElement(h.Icon,{source:i("Discord")}),trailing:h.Arrow,onPress:()=>W.openURL(fe)}),React.createElement(X,null),React.createElement(h,{label:"GitHub",leading:()=>React.createElement(h.Icon,{source:i("img_account_sync_github_white")}),trailing:h.Arrow,onPress:()=>W.openURL(ge)})),React.createElement(xe,{title:"Debug"},React.createElement(ht,{value:e,onChange:r=>t(r),title:"DEBUGGER URL"}),React.createElement(X,null),React.createElement(h,{label:"Connect to debug websocket",leading:()=>React.createElement(h.Icon,{source:i("copy")}),trailing:h.Arrow,onPress:()=>z(e)}),React.createElement(X,null),React.createElement(h,{label:"Reload Discord",leading:()=>React.createElement(h.Icon,{source:i("ic_message_retry")}),trailing:h.Arrow,onPress:()=>d.NativeModules.BundleUpdaterManager.reload()})),React.createElement(xe,{title:"Versions"},o.map(r=>React.createElement(React.Fragment,null,React.createElement(we,{label:r.label,version:r.version,icon:r.icon}),React.createElement(X,null)))))}var qe={get(e,t){let o=Reflect.get(e,t);return typeof o=="object"&&o!==null?new Proxy(o,qe):o},set(e,t,o){return Reflect.set(e,t,o),k.setItem("VENDETTA_PLUGINS",JSON.stringify(f)),!0},deleteProperty(e,t){return Reflect.deleteProperty(e,t),k.setItem("VENDETTA_PLUGINS",JSON.stringify(f)),!0}},f=new Proxy({},qe),D={};async function j(e){if(e.endsWith("/")||(e+="/"),typeof e!="string"||e in f)throw new Error("Plugin ID invalid or taken");let t;try{t=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let o;try{o=await(await fetch(new URL(t.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(o.length===0)throw new Error(`Failed to fetch JS for ${e}`);f[e]={id:e,manifest:t,enabled:!1,update:!0,js:o}}function Ie(e){let t=Object.assign({},window.vendetta),o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,r=(0,eval)(o)(t),n=typeof r=="function"?r():r;return n.default||n}function ve(e){let t=f[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=Ie(t);D[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){S.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{D[t.id]?.onUnload?.()}catch(r){S.error(`Plugin ${t.id} errored whilst unloading`,r)}delete D[e],t.enabled=!1}}function $(e){let t=f[e],o=D[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{D[t.id]?.onUnload?.()}catch(r){S.error(`Plugin ${t.id} errored whilst unloading`,r)}delete D[e],t.enabled=!1}function Q(e){f[e].enabled&&$(e),delete f[e]}var q=e=>D[e]?.settings,Ze=()=>k.getItem("VENDETTA_PLUGINS").then(async function(e){if(!e)return;let t=JSON.parse(e);for(let o of Object.keys(t)){let r=t[o];t[o].update?await j(r.id):f[o]=t[o],t[o].enabled&&f[o]&&ve(o)}});var O=m.createThemedStyleSheet({container:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},card:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:m.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:m.ThemeColorMap.HEADER_PRIMARY},headerTitle:{fontFamily:le.Fonts.PRIMARY_BOLD,color:m.ThemeColorMap.HEADER_PRIMARY},backIcon:{tintColor:m.ThemeColorMap.INTERACTIVE_ACTIVE,marginLeft:15,marginRight:20}}),et=me.createStackNavigator(),{TouchableOpacity:bt,Image:St}=U;function Ae({plugin:e,children:t}){return React.createElement(de.NavigationContainer,null,React.createElement(et.Navigator,{initialRouteName:e.manifest.name,style:O.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:O.card,headerStyle:O.header,headerTitleContainerStyle:O.headerTitleContainer}},React.createElement(et.Screen,{name:e.manifest.name,component:t,options:{headerTitleStyle:O.headerTitle,headerLeft:()=>React.createElement(bt,{onPress:()=>C.pop()},React.createElement(St,{style:O.backIcon,source:i("back-icon")}))}})))}var{FormRow:De,FormSwitch:wt}=u,{TouchableOpacity:Ne,Image:Ee}=U,_=m.createThemedStyleSheet({card:{backgroundColor:m.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:m.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,marginLeft:5,tintColor:m.ThemeColorMap.INTERACTIVE_NORMAL}});function Fe({plugin:e}){let[t,o]=React.useState(e.enabled),[r,n]=React.useState(e.update),[l,c]=React.useState(!1),s=q(e.id);return l?React.createElement(React.Fragment,null):React.createElement(d.View,{style:_.card},React.createElement(De,{style:_.header,label:`${e.manifest.name} by ${e.manifest.authors.map(a=>a.name).join(", ")}`,leading:React.createElement(De.Icon,{source:i(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(wt,{value:e.enabled,onValueChange:a=>{a?ve(e.id):$(e.id),o(a)}})}),React.createElement(De,{label:e.manifest.description,trailing:React.createElement(d.View,{style:_.actions},React.createElement(Ne,{onPress:()=>{Q(e.id),c(!0)}},React.createElement(Ee,{style:_.icon,source:i("ic_message_delete")})),React.createElement(Ne,{onPress:()=>{e.update=!e.update,n(e.update),g(`${e.update?"Enabled":"Disabled"} updates for ${e.manifest.name}.`,i("toast_image_saved"))}},React.createElement(Ee,{style:_.icon,source:i(e.update?"Check":"Small")})),s&&React.createElement(Ne,{onPress:()=>{C.push(Ae,{plugin:e,children:s})}},React.createElement(Ee,{style:_.icon,source:i("settings")})))}))}var{FormInput:xt,FormRow:Oe}=u;function _e(){let[e,t]=React.useState(""),[o,r]=React.useState(f);return React.createElement(React.Fragment,null,React.createElement(xt,{value:e,onChange:n=>t(n),title:"PLUGIN URL"}),React.createElement(Oe,{label:"Install plugin",leading:()=>React.createElement(Oe.Icon,{source:i("add_white")}),trailing:Oe.Arrow,onPress:()=>{j(e).then(()=>{t(""),r(f)}).catch(n=>{g(n.message,i("Small"))})}}),React.createElement(d.FlatList,{data:Object.values(o),renderItem:({item:n})=>React.createElement(Fe,{plugin:n}),keyExtractor:n=>n.id}))}var{FormRow:Pt}=u,Rt=m.createThemedStyleSheet({asset:{width:32,height:32}});function Me({asset:e}){return React.createElement(Pt,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(d.Image,{source:e.id,style:Rt.asset}),onPress:()=>{A(e.name),g("Copied asset name to clipboard.",i("toast_copy_link"))}})}var{FormInput:Tt,FormDivider:It}=u;function Be(){let[e,t]=React.useState("");return React.createElement(React.Fragment,null,React.createElement(Tt,{value:e,onChange:o=>t(o),title:"SEARCH"}),React.createElement(d.FlatList,{data:Object.values(P).filter(o=>o.name.includes(e)),renderItem:({item:o})=>React.createElement(React.Fragment,null,React.createElement(Me,{asset:o}),React.createElement(It,null)),keyExtractor:o=>o.name}))}var vt=H("getScreens",!1),At=H("UserSettingsOverviewWrapper",!1),Z=[];function Ce(){x("default",vt,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:Te},VendettaPlugins:{title:"Plugins",render:_e},VendettaAssetBrowser:{title:"Asset Browser",render:Be}})),x("default",At,(e,t)=>{for(let r of Z)r();Z=[];let o=V(t.props.children,r=>r.type&&r.type.name==="UserSettingsOverview");Z.push(x("renderSupportAndAcknowledgements",o.type.prototype,(r,{props:{children:n}})=>{let l=n.findIndex(c=>c?.type?.name==="UploadLogsButton");l!==-1&&n.splice(l,1)})),Z.push(x("render",o.type.prototype,(r,{props:{children:n}})=>{let l=[Y.Messages.BILLING_SETTINGS,Y.Messages.PREMIUM_SETTINGS],c=n.findIndex(s=>l.includes(s.props.title));n.splice(c===-1?4:c,0,React.createElement(Se,{navigation:o.props.navigation}))}))})}var Dt=p("updateTheme","overrideTheme"),tt=p("setAMOLEDThemeEnabled"),ot=J("ThemeStore"),Nt=J("UnsyncedUserSettingsStore");function rt(){try{if(ot){let t=function(){let o=ot.theme||"dark";Dt.overrideTheme(o),tt&&Nt.useAMOLEDTheme===2&&tt.setAMOLEDThemeEnabled(!0),K.unsubscribe("I18N_LOAD_START",t)};var e=t;K.subscribe("I18N_LOAD_START",t)}}catch(t){S.error("Failed to fix theme...",t)}}console.log("Hello from Vendetta!");async function Et(){let e=!1;try{window.vendetta={patcher:Ve,metro:{...ae,common:{...ue}},constants:{...ye},utils:{copyText:A,findInReactTree:V,findInTree:L},debug:{connectToDebugger:z},ui:{components:{...he},toasts:{...be},assets:{all:P,find:Je,getAssetByID:We,getAssetByName:Ye,getAssetIDByName:i}},plugins:{plugins:f,fetchPlugin:j,evalPlugin:Ie,stopPlugin:$,removePlugin:Q,getSettings:q},logger:S},Ce(),He(),ze(),rt(),Ze()}catch(t){e=!0,alert(`Vendetta failed to initialize... ${t.stack||t.toString()}`)}e||S.log("Vendetta is ready!")}Et();})();
//# sourceURL=Vendetta
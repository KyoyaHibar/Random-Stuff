"use strict";(()=>{var He=Object.defineProperty;var F=(e,t)=>{for(var o in t)He(e,o,{get:t[o],enumerable:!0})};var K={};F(K,{after:()=>w,before:()=>Ye,instead:()=>Je,unpatchAll:()=>Te});var Y=["a","b","i"],b=new Map;function Pe(e,t,o,r,n){let a=b.get(t)?.[e];if(!a)return n?Reflect.construct(t[e],o,r):t[e].apply(r,o);for(let l of a.b.values()){let g=l.call(r,o);Array.isArray(g)&&(o=g)}let c=(...l)=>n?Reflect.construct(a.o,l,r):a.o.apply(r,l);for(let l of a.i.values()){let g=c;c=(...I)=>l.call(r,I,g)}let i=c(...o);for(let l of a.a.values())i=l.call(r,o,i)??i;return i}function J(e,t,o,r){let n=b.get(e),a=n?.[t];return a?.[r].has(o)?(a[r].delete(o),Y.every(c=>a[c].size===0)&&(Reflect.defineProperty(e,t,{value:a.o,writable:!0,configurable:!0})||(e[t]=a.o),delete n[t]),Object.keys(n).length==0&&b.delete(e),!0):!1}function Te(){for(let[e,t]of b.entries())for(let o in t)for(let r of Y)for(let n of t[o]?.[r].keys()??[])J(e,o,n,r)}var V=e=>(t,o,r,n=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);b.has(o)||b.set(o,{});let a=b.get(o);if(!a[t]){let l=o[t];a[t]={o:l,b:new Map,i:new Map,a:new Map};let g=(y,v,C)=>{let Ge=Pe(t,o,v,y,C);return n&&i(),Ge},I=new Proxy(l,{apply:(y,v,C)=>g(v,C,!1),construct:(y,v)=>g(l,v,!0),get:(y,v,C)=>v=="toString"?l.toString.bind(l):Reflect.get(y,v,C)});Reflect.defineProperty(o,t,{value:I,configurable:!0,writable:!0})||(o[t]=I)}let c=Symbol(),i=()=>J(o,t,c,e);return a[t][e].set(c,r),i};var Ye=V("b"),Je=V("i"),w=V("a");var Ne={...K};var q={};F(q,{filterModules:()=>z,find:()=>O,findAll:()=>Q,findByDisplayName:()=>U,findByDisplayNameAll:()=>We,findByProps:()=>p,findByPropsAll:()=>Ke,modules:()=>X});function De(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){De(t);continue}}window.React=Object.values(window.modules).find(e=>e.publicModule.exports.createElement).publicModule.exports;var W=Object.values(window.modules).find(e=>e.publicModule.exports.isMoment).publicModule.exports,z=(e,t=!1)=>o=>{let r=[],n=W?.locale();for(let a in e){let c=Number(a),i=e[c].publicModule.exports;if(!e[c].isInitialized)try{__r(c),n&&n!==W.locale()&&W.locale(n)}catch{}if(!i){De(c);continue}try{if(i.default&&i.__esModule&&o(i.default)){if(t)return i.default;r.push(i.default)}if(o(i)){if(t)return i;r.push(i)}}catch(l){console.error(`Failed to getModule... ${l.stack||l.toString()}`)}}if(!t)return r},X=window.modules,O=z(X,!0),Q=z(X),Fe=e=>t=>e.every(o=>t[o]!==void 0),Ee=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,p=(...e)=>O(Fe(e)),Ke=(...e)=>Q(Fe(e)),U=(e,t=!0)=>O(Ee(e,t)),We=(e,t=!0)=>Q(Ee(e,t));var ze=p("setLogFn").default,Xe=new ze("Vendetta"),x=Xe;var ne={};F(ne,{AsyncStorage:()=>Ze,NavigationNative:()=>re,React:()=>qe,ReactNative:()=>m,assets:()=>B,channels:()=>Qe,clipboard:()=>te,constants:()=>Z,i18n:()=>j,navigation:()=>M,navigationStack:()=>oe,stylesheet:()=>d,toasts:()=>ee,url:()=>$});var Z=p("API_HOST"),Qe=p("getVoiceChannelId"),j=p("Messages"),$=p("openURL"),ee=O(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),d=p("createThemedStyleSheet"),te=p("setString","getString"),B=p("registerAsset"),M=p("pushLazy"),oe=p("createStackNavigator"),re=p("NavigationContainer"),qe=p("createElement"),m=p("Text","Image"),Ze=p("setItem");function P(e){try{te.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function k(e,t,{walkable:o=[],ignore:r=[],maxDepth:n=100}={}){let a=0;function c(i,l,{walkable:g=[],ignore:I=[]}={}){if(a+=1,!(a>n)){if(typeof l=="string"){if(i.hasOwnProperty(l))return i[l]}else if(l(i))return i;if(!!i){if(Array.isArray(i))for(let D of i){let y=c(D,l,{walkable:g,ignore:I});if(y)return y}else if(typeof i=="object"){for(let D of Object.keys(i))if(!(g!=null&&g.includes(D))&&!I.includes(D))try{let y=c(i[D],l,{walkable:g,ignore:I});if(y)return y}catch{}}}}}return c(e,t,{walkable:o,ignore:r})}function _(e,t){return k(e,t,{walkable:["props","children","child","sibling"]})}var ae={};F(ae,{DISCORD_SERVER:()=>ie,GITHUB:()=>se});var ie="https://discord.gg/n9QQ4XhhJP",se="https://github.com/vendetta-mod";var le={};F(le,{Forms:()=>f,General:()=>L});var f=p("Form","FormSection"),L=p("Button","Text","View");var ce={};F(ce,{showToast:()=>h});function h(e,t){return ee.open({content:e,source:t})}var S={};function pe(){try{w("registerAsset",B,(e,t)=>{let o=e[0];S[o.name]={...o,id:t}});for(let e=1;;e++){let t=B.getAssetByID(e);if(!t)break;S[t.name]||(S[t.name]={...t,id:e})}}catch{}}var Ce=e=>Object.values(S).find(e),Oe=e=>S[e],Be=e=>B.getAssetByID(e),s=e=>S[e]?.id;var{FormRow:R,FormSection:et}=f;function de({navigation:e}){return React.createElement(et,{key:"Vendetta",title:"Vendetta"},React.createElement(R,{label:"General",leading:()=>React.createElement(R.Icon,{source:s("settings")}),trailing:R.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(R,{label:"Plugins",leading:()=>React.createElement(R.Icon,{source:s("debug")}),trailing:R.Arrow,onPress:()=>e.push("VendettaPlugins")}),React.createElement(R,{label:"Asset Browser",leading:()=>React.createElement(R.Icon,{source:s("grid")}),trailing:R.Arrow,onPress:()=>e.push("VendettaAssetBrowser")}))}var A,tt=eval;function G(e){if(A!==void 0&&A.readyState!==WebSocket.CLOSED&&A.close(),e===""){h("Invalid debugger URL!",s("Small"));return}A=new WebSocket(`ws://${e}`),A.addEventListener("open",()=>h("Connected to debugger.",s("Check"))),A.addEventListener("message",t=>{try{tt(t.data)}catch(o){console.error(o)}}),A.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),h("An error occurred with the debugger connection!",s("Small"))})}function Me(){w("nativeLoggingHook",globalThis,(e,t)=>{A?.readyState===WebSocket.OPEN&&A.send(JSON.stringify({message:e[0],level:e[1]})),x.log(e[0])})}var{FormRow:ke,FormText:ot}=f;function me({label:e,version:t,icon:o}){return React.createElement(ke,{label:e,leading:()=>React.createElement(ke.Icon,{source:s(o)}),trailing:()=>React.createElement(ot,null,t),onPress:()=>{P(`${e} - ${t}`),h("Copied version to clipboard.",s("toast_copy_link"))}})}var{FormRow:u,FormSection:fe,FormInput:rt}=f,ge=window.HermesInternal.getRuntimeProperties(),ue=m.Platform.constants.reactNativeVersion;function ye(){let[e,t]=React.useState(""),o=[{label:"Discord",version:m.NativeModules.InfoDictionaryManager.Version,icon:"Discord"},{label:"React",version:React.version,icon:"ic_category_16px"},{label:"React Native",version:`${ue.major||0}.${ue.minor||0}.${ue.patch||0}`,icon:"mobile"},{label:"Hermes",version:`${ge["OSS Release Version"]} ${ge.Build} | Bytecode ${ge["Bytecode Version"]}`,icon:"ic_badge_staff"}];return React.createElement(m.ScrollView,null,React.createElement(fe,{title:"Links",android_noDivider:!0},React.createElement(u,{label:"Discord Server",leading:()=>React.createElement(u.Icon,{source:s("Discord")}),trailing:u.Arrow,onPress:()=>$.openURL(ie)}),React.createElement(u,{label:"GitHub",leading:()=>React.createElement(u.Icon,{source:s("img_account_sync_github_white")}),trailing:u.Arrow,onPress:()=>$.openURL(se)})),React.createElement(fe,{title:"Debug"},React.createElement(rt,{value:e,onChange:r=>t(r),title:"DEBUGGER URL"}),React.createElement(u,{label:"Connect to debug websocket",leading:()=>React.createElement(u.Icon,{source:s("copy")}),trailing:u.Arrow,onPress:()=>G(e)}),React.createElement(u,{label:"Reload Discord",leading:()=>React.createElement(u.Icon,{source:s("ic_message_retry")}),trailing:u.Arrow,onPress:()=>m.NativeModules.BundleUpdaterManager.reload()})),React.createElement(fe,{title:"Versions"},o.map(r=>React.createElement(me,{label:r.label,version:r.version,icon:r.icon}))))}var N={},T={};async function _e(e){e.endsWith("/")||(e+="/");let t=e.split("://")[1];if(typeof e!="string"||e in N)throw new Error("Plugin ID invalid or taken");let o;try{o=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let r;try{r=await(await fetch(new URL(o.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(r.length===0)throw new Error(`Failed to fetch JS for ${e}`);N[t]={id:t,manifest:o,enabled:!1,js:r}}function nt(e){let t=Object.assign({},window.vendetta),o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,r=(0,eval)(o)(t),n=typeof r=="function"?r():r;return n.default||n}function Le(e){let t=N[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=nt(t);T[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){x.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{T[t.id]?.onUnload?.()}catch(r){x.error(`Plugin ${t.id} errored whilst unloading`,r)}delete T[e],t.enabled=!1}}function Ve(e){let t=N[e],o=T[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{T[t.id]?.onUnload?.()}catch(r){x.error(`Plugin ${t.id} errored whilst unloading`,r)}delete T[e],t.enabled=!1}var Ue=e=>T[e]?.settings;var E=d.createThemedStyleSheet({container:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:d.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:d.ThemeColorMap.HEADER_PRIMARY},headerTitle:{fontFamily:Z.Fonts.PRIMARY_BOLD,color:d.ThemeColorMap.HEADER_PRIMARY},backIcon:{tintColor:d.ThemeColorMap.INTERACTIVE_ACTIVE,marginLeft:15,marginRight:20}}),je=oe.createStackNavigator(),{TouchableOpacity:it,Image:st}=L;function he({plugin:e,children:t}){return React.createElement(re.NavigationContainer,null,React.createElement(je.Navigator,{initialRouteName:e.manifest.name,style:E.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:E.cardStyle,headerStyle:E.header,headerTitleContainerStyle:E.headerTitleContainer}},React.createElement(je.Screen,{name:e.manifest.name,component:t,options:{headerTitleStyle:E.headerTitle,headerLeft:()=>React.createElement(it,{onPress:()=>M.pop()},React.createElement(st,{style:E.backIcon,source:s("back-icon")}))}})))}var{FormRow:be,FormSwitch:at}=f,{TouchableOpacity:lt,Image:ct}=L,H=d.createThemedStyleSheet({card:{backgroundColor:d.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:d.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,tintColor:d.ThemeColorMap.INTERACTIVE_NORMAL}});function we({plugin:e}){let[t,o]=React.useState(e.enabled),r=Ue(e.id);return React.createElement(m.View,{style:H.card},React.createElement(be,{style:H.header,label:`${e.manifest.name} by ${e.manifest.authors.map(n=>n.name).join(", ")}`,leading:React.createElement(be.Icon,{source:s(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(at,{value:e.enabled,onValueChange:n=>{n?Le(e.id):Ve(e.id),o(n)}})}),React.createElement(be,{label:e.manifest.description,trailing:React.createElement(m.View,{style:H.actions},r&&React.createElement(lt,{onPress:()=>{M.push(he,{plugin:e,children:r})}},React.createElement(ct,{style:H.icon,source:s("settings")})))}))}var{FormInput:pt,FormRow:Se,FormText:dt}=f,$e=d.createThemedStyleSheet({disclaimer:{backgroundColor:d.ThemeColorMap.BACKGROUND_SECONDARY,padding:10},disclaimerText:{textAlign:"center"}});function xe(){let[e,t]=React.useState(""),[o,r]=React.useState(N);return React.createElement(React.Fragment,null,React.createElement(pt,{value:e,onChange:n=>t(n),title:"PLUGIN URL"}),React.createElement(Se,{label:"Install plugin",leading:()=>React.createElement(Se.Icon,{source:s("add_white")}),trailing:Se.Arrow,onPress:()=>{_e(e).then(()=>{t(""),r(N)}).catch(n=>{h(n.message,s("Small"))})}}),React.createElement(m.FlatList,{data:Object.values(o),renderItem:({item:n})=>React.createElement(we,{plugin:n}),keyExtractor:n=>n.id}),React.createElement(m.View,{style:$e.disclaimer},React.createElement(dt,{style:$e.disclaimerText},"Plugins are currently non-permanent whilst I find a storage solution.")))}var{FormRow:mt}=f,ft=d.createThemedStyleSheet({asset:{width:32,height:32}});function Re({asset:e}){return React.createElement(mt,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(m.Image,{source:e.id,style:ft.asset}),onPress:()=>{P(e.name),h("Copied asset name to clipboard.",s("toast_copy_link"))}})}var{FormInput:gt}=f;function Ae(){let[e,t]=React.useState("");return React.createElement(React.Fragment,null,React.createElement(gt,{value:e,onChange:o=>t(o),title:"SEARCH"}),React.createElement(m.FlatList,{data:Object.values(S).filter(o=>o.name.includes(e)),renderItem:({item:o})=>React.createElement(Re,{asset:o}),keyExtractor:o=>o.name}))}var ut=U("getScreens",!1),yt=U("UserSettingsOverviewWrapper",!1),Ie=!1;function ve(){w("default",ut,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:ye},VendettaPlugins:{title:"Plugins",render:xe},VendettaAssetBrowser:{title:"Asset Browser",render:Ae}})),w("default",yt,(e,t)=>{let o=_(t.props.children,r=>r.type&&r.type.name==="UserSettingsOverview");w("renderSupportAndAcknowledgements",o.type.prototype,(r,{props:{children:n}})=>{let a=n.findIndex(c=>c?.type?.name==="UploadLogsButton");a!==-1&&n.splice(a,1)}),w("render",o.type.prototype,(r,{props:{children:n}})=>{let a=[j.Messages.BILLING_SETTINGS,j.Messages.PREMIUM_SETTINGS],c=n.findIndex(i=>a.includes(i.props.title));n.splice(c===-1?4:c,Ie?1:0,React.createElement(de,{navigation:o.props.navigation})),Ie||(Ie=!0)})})}console.log("Hello from Vendetta!");async function ht(){let e=!1;try{window.vendetta={patcher:Ne,metro:{...q,common:{...ne}},constants:{...ae},utils:{copyText:P,findInReactTree:_,findInTree:k},debug:{connectToDebugger:G},ui:{components:{...le},toasts:{...ce},assets:{all:S,find:Ce,getAssetByID:Be,getAssetByName:Oe,getAssetIDByName:s}},logger:x},ve(),pe(),Me()}catch(t){e=!0,alert(`Vendetta failed to initialize... ${t.stack||t.toString()}`)}e||x.log("Vendetta is ready!")}ht();})();
//# sourceURL=Vendetta
"use strict";(()=>{var ct=Object.defineProperty;var E=(e,t)=>{for(var o in t)ct(e,o,{get:t[o],enumerable:!0})};var re={};E(re,{after:()=>v,before:()=>pt,instead:()=>mt,unpatchAll:()=>je});var te=["a","b","i"],x=new Map;function Ue(e,t,o,n,r){let i=x.get(t)?.[e];if(!i)return r?Reflect.construct(t[e],o,n):t[e].apply(n,o);for(let c of i.b.values()){let y=c.call(n,o);Array.isArray(y)&&(o=y)}let s=(...c)=>r?Reflect.construct(i.o,c,n):i.o.apply(n,c);for(let c of i.i.values()){let y=s;s=(...R)=>c.call(n,R,y)}let a=s(...o);for(let c of i.a.values())a=c.call(n,o,a)??a;return a}function oe(e,t,o,n){let r=x.get(e),i=r?.[t];return i?.[n].has(o)?(i[n].delete(o),te.every(s=>i[s].size===0)&&(Reflect.defineProperty(e,t,{value:i.o,writable:!0,configurable:!0})||(e[t]=i.o),delete r[t]),Object.keys(r).length==0&&x.delete(e),!0):!1}function je(){for(let[e,t]of x.entries())for(let o in t)for(let n of te)for(let r of t[o]?.[n].keys()??[])oe(e,o,r,n)}var J=e=>(t,o,n,r=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);x.has(o)||x.set(o,{});let i=x.get(o);if(!i[t]){let c=o[t];i[t]={o:c,b:new Map,i:new Map,a:new Map};let y=(h,P,C)=>{let lt=Ue(t,o,P,h,C);return r&&a(),lt},R=new Proxy(c,{apply:(h,P,C)=>y(P,C,!1),construct:(h,P)=>y(c,P,!0),get:(h,P,C)=>P=="toString"?c.toString.bind(c):Reflect.get(h,P,C)});Reflect.defineProperty(o,t,{value:R,configurable:!0,writable:!0})||(o[t]=R)}let s=Symbol(),a=()=>oe(o,t,s,e);return i[t][e].set(s,n),a};var pt=J("b"),mt=J("i"),v=J("a");var $e={...re};var le={};E(le,{filterModules:()=>ie,find:()=>O,findAll:()=>ae,findByDisplayName:()=>Y,findByDisplayNameAll:()=>ut,findByProps:()=>p,findByPropsAll:()=>dt,findByStoreName:()=>W,modules:()=>se});function Ge(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){Ge(t);continue}}var He=e=>Object.values(window.modules).find(t=>t.publicModule.exports?.[e]).publicModule.exports;window.React=He("createElement");var ne=He("isMoment"),ie=(e,t=!1)=>o=>{let n=[],r=ne?.locale();for(let i in e){let s=Number(i),a=e[s].publicModule.exports;if(!e[s].isInitialized)try{__r(s),r&&r!==ne.locale()&&ne.locale(r)}catch{}if(!a){Ge(s);continue}try{if(a.default&&a.__esModule&&o(a.default)){if(t)return a.default;n.push(a.default)}if(o(a)){if(t)return a;n.push(a)}}catch(c){console.error(`Failed to getModule... ${c.stack||c.toString()}`)}}if(!t)return n},se=window.modules,O=ie(se,!0),ae=ie(se),Je=e=>t=>e.every(o=>t[o]!==void 0),Ye=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,p=(...e)=>O(Je(e)),dt=(...e)=>ae(Je(e)),Y=(e,t=!0)=>O(Ye(e,t)),ut=(e,t=!0)=>ae(Ye(e,t)),W=e=>O(t=>t.getName?.()===e);var ft=p("setLogFn").default,gt=new ft("Vendetta"),b=gt;var fe={};E(fe,{AsyncStorage:()=>L,Flux:()=>ht,FluxDispatcher:()=>X,NavigationNative:()=>ue,React:()=>bt,ReactNative:()=>d,assets:()=>k,channels:()=>yt,clipboard:()=>me,constants:()=>ce,i18n:()=>K,navigation:()=>B,navigationStack:()=>de,stylesheet:()=>m,toasts:()=>pe,url:()=>z});var ce=p("API_HOST"),yt=p("getVoiceChannelId"),K=p("Messages"),z=p("openURL"),pe=O(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),m=p("createThemedStyleSheet"),me=p("setString","getString"),k=p("registerAsset"),B=p("pushLazy"),de=p("createStackNavigator"),ue=p("NavigationContainer"),ht=p("connectStores"),X=p("_currentDispatchActionType"),bt=p("createElement"),d=p("Text","Image"),L=p("setItem");function D(e){try{me.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function V(e,t,{walkable:o=[],ignore:n=[],maxDepth:r=100}={}){let i=0;function s(a,c,{walkable:y=[],ignore:R=[]}={}){if(i+=1,!(i>r)){if(typeof c=="string"){if(a.hasOwnProperty(c))return a[c]}else if(c(a))return a;if(!!a){if(Array.isArray(a))for(let N of a){let h=s(N,c,{walkable:y,ignore:R});if(h)return h}else if(typeof a=="object"){for(let N of Object.keys(a))if(!(y!=null&&y.includes(N))&&!R.includes(N))try{let h=s(a[N],c,{walkable:y,ignore:R});if(h)return h}catch{}}}}}return s(e,t,{walkable:o,ignore:n})}function U(e,t){return V(e,t,{walkable:["props","children","child","sibling"]})}var he={};E(he,{DISCORD_SERVER:()=>ge,GITHUB:()=>ye});var ge="https://discord.gg/n9QQ4XhhJP",ye="https://github.com/vendetta-mod";var be={};E(be,{Forms:()=>u,General:()=>j});var u=p("Form","FormSection"),j=p("Button","Text","View");var Se={};E(Se,{showToast:()=>f});function f(e,t){return pe.open({content:e,source:t})}var w={};function We(){try{v("registerAsset",k,(e,t)=>{let o=e[0];w[o.name]={...o,id:t}});for(let e=1;;e++){let t=k.getAssetByID(e);if(!t)break;w[t.name]||(w[t.name]={...t,id:e})}}catch{}}var Ke=e=>Object.values(w).find(e),ze=e=>w[e],Xe=e=>k.getAssetByID(e),l=e=>w[e]?.id;function $(e,t){let o={},n={get(r,i){let s=Reflect.get(r,i);return typeof s=="object"&&s!==null?new Proxy(s,n):s},set(r,i,s){return Reflect.set(r,i,s),L.setItem(e,JSON.stringify(o)),!0},deleteProperty(r,i){return Reflect.deleteProperty(r,i),L.setItem(e,JSON.stringify(o)),!0}};return L.getItem(e).then(async function(r){if(!r)return;let i=JSON.parse(r);if(t&&typeof t=="function")t(i);else for(let s of Object.keys(i))o[s]=i[s]}),new Proxy(o,n)}var A=$("VENDETTA_SETTINGS");var{FormRow:T,FormSection:St,FormDivider:Qe}=u;function xe({navigation:e}){return React.createElement(St,{key:"Vendetta",title:"Vendetta"},React.createElement(T,{label:"General",leading:()=>React.createElement(T.Icon,{source:l("settings")}),trailing:T.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(Qe,null),React.createElement(T,{label:"Plugins",leading:()=>React.createElement(T.Icon,{source:l("debug")}),trailing:T.Arrow,onPress:()=>e.push("VendettaPlugins")}),A.developerSettings&&React.createElement(React.Fragment,null,React.createElement(Qe,null),React.createElement(T,{label:"Developer",leading:()=>React.createElement(T.Icon,{source:l("ic_progress_wrench_24px")}),trailing:T.Arrow,onPress:()=>e.push("VendettaDeveloper")})))}var{FormRow:qe,FormText:xt}=u;function ve({label:e,version:t,icon:o}){return React.createElement(qe,{label:e,leading:()=>React.createElement(qe.Icon,{source:l(o)}),trailing:()=>React.createElement(xt,null,t),onPress:()=>{D(`${e} - ${t}`),f("Copied version to clipboard.",l("toast_copy_link"))}})}var{FormRow:S,FormSection:we,FormDivider:Te,FormSwitch:vt}=u,Ze=d.NativeModules.InfoDictionaryManager,Ie=window.HermesInternal.getRuntimeProperties(),Re=d.Platform.constants.reactNativeVersion;function Pe(){let[e,t]=React.useState(A.developerSettings||!1),o=[{label:"Discord",version:`${Ze.Version} (${Ze.Build})`,icon:"Discord"},{label:"React",version:React.version,icon:"ic_category_16px"},{label:"React Native",version:`${Re.major||0}.${Re.minor||0}.${Re.patch||0}`,icon:"mobile"},{label:"Hermes",version:`${Ie["OSS Release Version"]} ${Ie.Build} | Bytecode ${Ie["Bytecode Version"]}`,icon:"ic_badge_staff"}];return React.createElement(d.ScrollView,null,React.createElement(we,{title:"Links"},React.createElement(S,{label:"Discord Server",leading:React.createElement(S.Icon,{source:l("Discord")}),trailing:S.Arrow,onPress:()=>z.openURL(ge)}),React.createElement(Te,null),React.createElement(S,{label:"GitHub",leading:React.createElement(S.Icon,{source:l("img_account_sync_github_white")}),trailing:S.Arrow,onPress:()=>z.openURL(ye)})),React.createElement(we,{title:"Versions"},o.map(n=>React.createElement(React.Fragment,null,React.createElement(ve,{label:n.label,version:n.version,icon:n.icon}),React.createElement(Te,null)))),React.createElement(we,{title:"Actions"},React.createElement(S,{label:"Reload Discord",leading:React.createElement(S.Icon,{source:l("ic_message_retry")}),trailing:S.Arrow,onPress:()=>d.NativeModules.BundleUpdaterManager.reload()}),React.createElement(Te,null),React.createElement(S,{label:"Developer Settings",leading:React.createElement(S.Icon,{source:l("ic_progress_wrench_24px")}),trailing:React.createElement(vt,{value:e,onValueChange:n=>{A.developerSettings=n,t(n)}})})))}var g=$("VENDETTA_PLUGINS",async function(e){for(let t of Object.keys(e)){let o=e[t];e[t].update?await G(o.id):g[t]=e[t],e[t].enabled&&g[t]&&De(t)}}),F={};async function G(e){if(e.endsWith("/")||(e+="/"),typeof e!="string"||e in g)throw new Error("Plugin ID invalid or taken");let t;try{t=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let o;try{o=await(await fetch(new URL(t.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(o.length===0)throw new Error(`Failed to fetch JS for ${e}`);g[e]={id:e,manifest:t,enabled:!1,update:!0,js:o}}function Ae(e){let t=Object.assign({},window.vendetta),o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,n=(0,eval)(o)(t),r=typeof n=="function"?n():n;return r.default||r}function De(e){let t=g[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=Ae(t);F[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){b.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{F[t.id]?.onUnload?.()}catch(n){b.error(`Plugin ${t.id} errored whilst unloading`,n)}delete F[e],t.enabled=!1}}function H(e){let t=g[e],o=F[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{F[t.id]?.onUnload?.()}catch(n){b.error(`Plugin ${t.id} errored whilst unloading`,n)}delete F[e],t.enabled=!1}function Q(e){g[e].enabled&&H(e),delete g[e]}var q=e=>F[e]?.settings;var _=m.createThemedStyleSheet({container:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},card:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:m.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:m.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:m.ThemeColorMap.HEADER_PRIMARY},headerTitle:{fontFamily:ce.Fonts.PRIMARY_BOLD,color:m.ThemeColorMap.HEADER_PRIMARY},backIcon:{tintColor:m.ThemeColorMap.INTERACTIVE_ACTIVE,marginLeft:15,marginRight:20}}),et=de.createStackNavigator(),{TouchableOpacity:wt,Image:Tt}=j;function Fe({plugin:e,children:t}){return React.createElement(ue.NavigationContainer,null,React.createElement(et.Navigator,{initialRouteName:e.manifest.name,style:_.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:_.card,headerStyle:_.header,headerTitleContainerStyle:_.headerTitleContainer}},React.createElement(et.Screen,{name:e.manifest.name,component:t,options:{headerTitleStyle:_.headerTitle,headerLeft:()=>React.createElement(wt,{onPress:()=>B.pop()},React.createElement(Tt,{style:_.backIcon,source:l("back-icon")}))}})))}var{FormRow:Ne,FormSwitch:It}=u,{TouchableOpacity:Ee,Image:Oe}=j,M=m.createThemedStyleSheet({card:{backgroundColor:m.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:m.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,marginLeft:5,tintColor:m.ThemeColorMap.INTERACTIVE_NORMAL}});function _e({plugin:e}){let[t,o]=React.useState(e.enabled),[n,r]=React.useState(e.update),[i,s]=React.useState(!1),a=q(e.id);return i?React.createElement(React.Fragment,null):React.createElement(d.View,{style:M.card},React.createElement(Ne,{style:M.header,label:`${e.manifest.name} by ${e.manifest.authors.map(c=>c.name).join(", ")}`,leading:React.createElement(Ne.Icon,{source:l(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(It,{value:e.enabled,onValueChange:c=>{c?De(e.id):H(e.id),o(c)}})}),React.createElement(Ne,{label:e.manifest.description,trailing:React.createElement(d.View,{style:M.actions},React.createElement(Ee,{onPress:()=>{Q(e.id),s(!0)}},React.createElement(Oe,{style:M.icon,source:l("ic_message_delete")})),React.createElement(Ee,{onPress:()=>{e.update=!e.update,r(e.update),f(`${e.update?"Enabled":"Disabled"} updates for ${e.manifest.name}.`,l("toast_image_saved"))}},React.createElement(Oe,{style:M.icon,source:l(e.update?"Check":"Small")})),a&&React.createElement(Ee,{onPress:()=>{B.push(Fe,{plugin:e,children:a})}},React.createElement(Oe,{style:M.icon,source:l("settings")})))}))}var{FormInput:Rt,FormRow:Me}=u;function Ce(){let[e,t]=React.useState(""),[o,n]=React.useState(g);return React.createElement(React.Fragment,null,React.createElement(Rt,{value:e,onChange:r=>t(r),title:"PLUGIN URL"}),React.createElement(Me,{label:"Install plugin",leading:()=>React.createElement(Me.Icon,{source:l("add_white")}),trailing:Me.Arrow,onPress:()=>{G(e).then(()=>{t(""),n(g)}).catch(r=>{f(r.message,l("Small"))})}}),React.createElement(d.FlatList,{data:Object.values(o),renderItem:({item:r})=>React.createElement(_e,{plugin:r}),keyExtractor:r=>r.id}))}var I;function Z(e){if(I!==void 0&&I.readyState!==WebSocket.CLOSED&&I.close(),e===""){f("Invalid debugger URL!",l("Small"));return}I=new WebSocket(`ws://${e}`),I.addEventListener("open",()=>f("Connected to debugger.",l("Check"))),I.addEventListener("message",t=>{try{(0,eval)(t.data)}catch(o){console.error(o)}}),I.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),f("An error occurred with the debugger connection!",l("Small"))})}function tt(){v("nativeLoggingHook",globalThis,(e,t)=>{I?.readyState===WebSocket.OPEN&&I.send(JSON.stringify({message:e[0],level:e[1]})),b.log(e[0])})}var{FormRow:Pt}=u,At=m.createThemedStyleSheet({asset:{width:32,height:32}});function ke({asset:e}){return React.createElement(Pt,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(d.Image,{source:e.id,style:At.asset}),onPress:()=>{D(e.name),f("Copied asset name to clipboard.",l("toast_copy_link"))}})}var{FormSection:ot,FormRow:Be,FormInput:rt,FormDivider:nt}=u;function Le(){let[e,t]=React.useState(A.debuggerUrl||""),[o,n]=React.useState("");return React.createElement(React.Fragment,null,React.createElement(ot,{title:"Debug"},React.createElement(rt,{value:e,onChange:r=>{A.debuggerUrl=r,t(r)},title:"DEBUGGER URL"}),React.createElement(nt,null),React.createElement(Be,{label:"Connect to debug websocket",leading:()=>React.createElement(Be.Icon,{source:l("copy")}),trailing:Be.Arrow,onPress:()=>Z(e)})),React.createElement(ot,{title:"Assets"},React.createElement(rt,{value:o,onChange:r=>n(r),title:"SEARCH"}),React.createElement(d.FlatList,{data:Object.values(w).filter(r=>r.name.includes(o)),renderItem:({item:r})=>React.createElement(React.Fragment,null,React.createElement(ke,{asset:r}),React.createElement(nt,null)),keyExtractor:r=>r.name})))}var Dt=Y("getScreens",!1),Ft=Y("UserSettingsOverviewWrapper",!1),ee=[];function Ve(){v("default",Dt,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:Pe},VendettaPlugins:{title:"Plugins",render:Ce},VendettaDeveloper:{title:"Developer",render:Le}})),v("default",Ft,(e,t)=>{for(let n of ee)n();ee=[];let o=U(t.props.children,n=>n.type&&n.type.name==="UserSettingsOverview");ee.push(v("renderSupportAndAcknowledgements",o.type.prototype,(n,{props:{children:r}})=>{let i=r.findIndex(s=>s?.type?.name==="UploadLogsButton");i!==-1&&r.splice(i,1)})),ee.push(v("render",o.type.prototype,(n,{props:{children:r}})=>{let i=[K.Messages.BILLING_SETTINGS,K.Messages.PREMIUM_SETTINGS],s=r.findIndex(a=>i.includes(a.props.title));r.splice(s===-1?4:s,0,React.createElement(xe,{navigation:o.props.navigation}))}))})}var Nt=p("updateTheme","overrideTheme"),it=p("setAMOLEDThemeEnabled"),st=W("ThemeStore"),Et=W("UnsyncedUserSettingsStore");function at(){try{if(st){let t=function(){let o=st.theme||"dark";Nt.overrideTheme(o),it&&Et.useAMOLEDTheme===2&&it.setAMOLEDThemeEnabled(!0),X.unsubscribe("I18N_LOAD_START",t)};var e=t;X.subscribe("I18N_LOAD_START",t)}}catch(t){b.error("Failed to fix theme...",t)}}console.log("Hello from Vendetta!");async function Ot(){let e=!1;try{window.vendetta={patcher:$e,metro:{...le,common:{...fe}},constants:{...he},utils:{copyText:D,findInReactTree:U,findInTree:V},debug:{connectToDebugger:Z},ui:{components:{...be},toasts:{...Se},assets:{all:w,find:Ke,getAssetByID:Xe,getAssetByName:ze,getAssetIDByName:l}},plugins:{plugins:g,fetchPlugin:G,evalPlugin:Ae,stopPlugin:H,removePlugin:Q,getSettings:q},logger:b},Ve(),We(),tt(),at()}catch(t){e=!0,alert(`Vendetta failed to initialize... ${t.stack||t.toString()}`)}e||b.log("Vendetta is ready!")}Ot();})();
//# sourceURL=Vendetta
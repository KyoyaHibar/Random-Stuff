"use strict";(()=>{var Me=Object.defineProperty;var B=(e,t)=>{for(var o in t)Me(e,o,{get:t[o],enumerable:!0})};var G={};B(G,{after:()=>w,before:()=>_e,instead:()=>Ve,unpatchAll:()=>we});var j=["a","b","i"],b=new Map;function be(e,t,o,r,n){let i=b.get(t)?.[e];if(!i)return n?Reflect.construct(t[e],o,r):t[e].apply(r,o);for(let l of i.b.values()){let f=l.call(r,o);Array.isArray(f)&&(o=f)}let c=(...l)=>n?Reflect.construct(i.o,l,r):i.o.apply(r,l);for(let l of i.i.values()){let f=c;c=(...I)=>l.call(r,I,f)}let s=c(...o);for(let l of i.a.values())s=l.call(r,o,s)??s;return s}function $(e,t,o,r){let n=b.get(e),i=n?.[t];return i?.[r].has(o)?(i[r].delete(o),j.every(c=>i[c].size===0)&&(Reflect.defineProperty(e,t,{value:i.o,writable:!0,configurable:!0})||(e[t]=i.o),delete n[t]),Object.keys(n).length==0&&b.delete(e),!0):!1}function we(){for(let[e,t]of b.entries())for(let o in t)for(let r of j)for(let n of t[o]?.[r].keys()??[])$(e,o,n,r)}var M=e=>(t,o,r,n=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);b.has(o)||b.set(o,{});let i=b.get(o);if(!i[t]){let l=o[t];i[t]={o:l,b:new Map,i:new Map,a:new Map};let f=(g,P,E)=>{let Oe=be(t,o,P,g,E);return n&&s(),Oe},I=new Proxy(l,{apply:(g,P,E)=>f(P,E,!1),construct:(g,P)=>f(l,P,!0),get:(g,P,E)=>P=="toString"?l.toString.bind(l):Reflect.get(g,P,E)});Reflect.defineProperty(o,t,{value:I,configurable:!0,writable:!0})||(o[t]=I)}let c=Symbol(),s=()=>$(o,t,c,e);return i[t][e].set(c,r),s};var _e=M("b"),Ve=M("i"),w=M("a");var xe={...G};var K={};B(K,{filterModules:()=>J,find:()=>k,findAll:()=>z,findByDisplayName:()=>_,findByDisplayNameAll:()=>Ce,findByProps:()=>p,findByPropsAll:()=>Le,modules:()=>W});function Se(e){Object.defineProperty(window.modules,e,{value:window.modules[e],enumerable:!1,configurable:!0,writable:!0})}for(let e in window.modules){let t=Number(e),o=window.modules[t].publicModule.exports;if(!o||o===window||o.proxygone===null){Se(t);continue}}window.React=Object.values(window.modules).find(e=>e.publicModule.exports.createElement).publicModule.exports;var H=Object.values(window.modules).find(e=>e.publicModule.exports.isMoment).publicModule.exports,J=(e,t=!1)=>o=>{let r=[],n=H?.locale();for(let i in e){let c=Number(i),s=e[c].publicModule.exports;if(!e[c].isInitialized)try{__r(c),n&&n!==H.locale()&&H.locale(n)}catch{}if(!s){Se(c);continue}try{if(s.default&&s.__esModule&&o(s.default)){if(t)return s.default;r.push(s.default)}if(o(s)){if(t)return s;r.push(s)}}catch(l){console.error(`Failed to getModule... ${l.stack||l.toString()}`)}}if(!t)return r},W=window.modules,k=J(W,!0),z=J(W),Re=e=>t=>e.every(o=>t[o]!==void 0),Ae=(e,t)=>t?o=>o.name===e:o=>o?.default?.name===e,p=(...e)=>k(Re(e)),Le=(...e)=>z(Re(e)),_=(e,t=!0)=>k(Ae(e,t)),Ce=(e,t=!0)=>z(Ae(e,t));var Ue=p("setLogFn").default,je=new Ue("Vendetta"),S=je;var $e=p("setString","getString");function v(e){try{$e.setString(e)}catch{throw new Error("Failed to set clipboard content.")}}function N(e,t,{walkable:o=[],ignore:r=[],maxDepth:n=100}={}){let i=0;function c(s,l,{walkable:f=[],ignore:I=[]}={}){if(i+=1,!(i>n)){if(typeof l=="string"){if(s.hasOwnProperty(l))return s[l]}else if(l(s))return s;if(!!s){if(Array.isArray(s))for(let D of s){let g=c(D,l,{walkable:f,ignore:I});if(g)return g}else if(typeof s=="object"){for(let D of Object.keys(s))if(!(f!=null&&f.includes(D))&&!I.includes(D))try{let g=c(s[D],l,{walkable:f,ignore:I});if(g)return g}catch{}}}}}return c(e,t,{walkable:o,ignore:r})}function O(e,t){return N(e,t,{walkable:["props","children","child","sibling"]})}var X={};B(X,{DISCORD_SERVER:()=>Y,GITHUB:()=>Q});var Y="https://discord.gg/n9QQ4XhhJP",Q="https://github.com/vendetta-mod";var Z={};B(Z,{AsyncStorage:()=>We,React:()=>Je,ReactNative:()=>d,channels:()=>He,constants:()=>Ge,i18n:()=>V,stylesheet:()=>y,toasts:()=>q,url:()=>L});var Ge=p("API_HOST"),He=p("getVoiceChannelId"),V=p("Messages"),L=p("openURL"),q=k(e=>e.open&&e.close&&!e.startDrag&&!e.init&&!e.openReplay&&!e.setAlwaysOnTop),y=p("createThemedStyleSheet"),Je=p("createElement"),d=p("Text","Image"),We=p("setItem");var te={};B(te,{Forms:()=>m,General:()=>ee});var m=p("Form","FormSection"),ee=p("Button","Text","View");var oe={};B(oe,{showToast:()=>h});function h(e,t){return q.open({content:e,source:t})}var re=p("registerAsset"),x={};function ne(){try{w("registerAsset",re,(e,t)=>{let o=e[0];x[o.name]={...o,id:t}});for(let e=1;;e++){let t=re.getAssetByID(e);if(!t)break;x[t.name]||(x[t.name]={...t,id:e})}}catch{}}var Ie=e=>Object.values(x).find(e),Pe=e=>x[e],ve=e=>re.getAssetByID(e),a=e=>x[e]?.id;var{FormRow:R,FormSection:ze}=m;function se({navigation:e}){return React.createElement(ze,{key:"Vendetta",title:"Vendetta"},React.createElement(R,{label:"General",leading:()=>React.createElement(R.Icon,{source:a("settings")}),trailing:R.Arrow,onPress:()=>e.push("VendettaSettings")}),React.createElement(R,{label:"Plugins",leading:()=>React.createElement(R.Icon,{source:a("debug")}),trailing:R.Arrow,onPress:()=>e.push("VendettaPlugins")}),React.createElement(R,{label:"Asset Browser",leading:()=>React.createElement(R.Icon,{source:a("grid")}),trailing:R.Arrow,onPress:()=>e.push("VendettaAssetBrowser")}))}var A,Ke=eval;function C(e){if(A!==void 0&&A.readyState!==WebSocket.CLOSED&&A.close(),e===""){h("Invalid debugger URL!",a("Small"));return}A=new WebSocket(`ws://${e}`),A.addEventListener("open",()=>h("Connected to debugger.",a("Check"))),A.addEventListener("message",t=>{try{Ke(t.data)}catch(o){console.error(o)}}),A.addEventListener("error",t=>{console.log(`Debugger error: ${t.message}`),h("An error occurred with the debugger connection!",a("Small"))})}function Te(){w("nativeLoggingHook",globalThis,(e,t)=>{A?.readyState===WebSocket.OPEN&&A.send(JSON.stringify({message:e[0],level:e[1]})),S.log(e[0])})}var{FormRow:Fe,FormText:Ye}=m;function ie({label:e,version:t,icon:o}){return React.createElement(Fe,{label:e,leading:()=>React.createElement(Fe.Icon,{source:a(o)}),trailing:()=>React.createElement(Ye,null,t),onPress:()=>{v(`${e} - ${t}`),h("Copied version to clipboard.",a("toast_copy_link"))}})}var{FormRow:u,FormSection:ae,FormInput:Qe}=m,le=window.HermesInternal.getRuntimeProperties(),ce=d.Platform.constants.reactNativeVersion;function pe(){let[e,t]=React.useState(""),o=[{label:"Discord",version:d.NativeModules.InfoDictionaryManager.Version,icon:"Discord"},{label:"React",version:React.version,icon:"ic_category_16px"},{label:"React Native",version:`${ce.major||0}.${ce.minor||0}.${ce.patch||0}`,icon:"mobile"},{label:"Hermes",version:`${le["OSS Release Version"]} ${le.Build} | Bytecode ${le["Bytecode Version"]}`,icon:"ic_hammer_and_chisel_24px"}];return React.createElement(d.ScrollView,null,React.createElement(ae,{title:"Links",android_noDivider:!0},React.createElement(u,{label:"Discord Server",leading:()=>React.createElement(u.Icon,{source:a("Discord")}),trailing:u.Arrow,onPress:()=>L.openURL(Y)}),React.createElement(u,{label:"GitHub",leading:()=>React.createElement(u.Icon,{source:a("img_account_sync_github_white")}),trailing:u.Arrow,onPress:()=>L.openURL(Q)})),React.createElement(ae,{title:"Debug"},React.createElement(Qe,{value:e,onChange:r=>t(r),title:"DEBUGGER URL"}),React.createElement(u,{label:"Connect to debug websocket",leading:()=>React.createElement(u.Icon,{source:a("copy")}),trailing:u.Arrow,onPress:()=>C(e)}),React.createElement(u,{label:"Reload Discord",leading:()=>React.createElement(u.Icon,{source:a("ic_message_retry")}),trailing:u.Arrow,onPress:()=>d.NativeModules.BundleUpdaterManager.reload()})),React.createElement(ae,{title:"Versions"},o.map(r=>React.createElement(ie,{label:r.label,version:r.version,icon:r.icon}))))}var F={},T={};async function De(e){e.endsWith("/")||(e+="/");let t=e.split("://")[1];if(typeof e!="string"||e in F)throw new Error("Plugin ID invalid or taken");let o;try{o=await(await fetch(new URL("manifest.json",e),{cache:"no-store"})).json()}catch{throw new Error(`Failed to fetch manifest for ${e}`)}let r;try{r=await(await fetch(new URL(o.main||"index.js",e),{cache:"no-store"})).text()}catch{throw new Error(`Failed to fetch JS for ${e}`)}if(r.length===0)throw new Error(`Failed to fetch JS for ${e}`);F[t]={id:t,manifest:o,enabled:!1,js:r}}function Xe(e){let t=Object.assign({},window.vendetta),o=`vendetta=>{return ${e.js}}
//# sourceURL=${e.id}`,r=(0,eval)(o)(t),n=typeof r=="function"?r():r;return n.default||n}function Be(e){let t=F[e];if(!t)throw new Error("Attempted to start non-existent plugin");try{let o=Xe(t);T[e]=o,o.onLoad?.(),t.enabled=!0}catch(o){S.error(`Plugin ${t.id} errored whilst loading, and will be unloaded`,o);try{T[t.id]?.onUnload?.()}catch(r){S.error(`Plugin ${t.id} errored whilst unloading`,r)}delete T[e],t.enabled=!1}}function Ee(e){let t=F[e],o=T[e];if(!t)throw new Error("Attempted to stop non-existent plugin");if(!o)throw new Error("Attempted to stop a non-started plugin");try{T[t.id]?.onUnload?.()}catch(r){S.error(`Plugin ${t.id} errored whilst unloading`,r)}delete T[e],t.enabled=!1}var ke=e=>T[e]?.settings;var{FormRow:de,FormSwitch:qe}=m,{TouchableOpacity:Ze,Image:et}=ee,tt=p("pushLazy"),U=y.createThemedStyleSheet({card:{backgroundColor:y.ThemeColorMap.BACKGROUND_SECONDARY,borderRadius:5,margin:10},header:{backgroundColor:y.ThemeColorMap.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},icon:{width:22,height:22,tintColor:y.ThemeColorMap.INTERACTIVE_NORMAL}});function me({plugin:e}){let[t,o]=React.useState(e.enabled),r=ke(e.id);return React.createElement(d.View,{style:U.card},React.createElement(de,{style:U.header,label:`${e.manifest.name} by ${e.manifest.authors.map(n=>n.name).join(", ")}`,leading:React.createElement(de.Icon,{source:a(e.manifest.vendetta.icon||"ic_application_command_24px")}),trailing:React.createElement(qe,{value:e.enabled,onValueChange:n=>{n?Be(e.id):Ee(e.id),o(n)}})}),React.createElement(de,{label:e.manifest.description,trailing:React.createElement(d.View,{style:U.actions},r&&React.createElement(Ze,{onPress:()=>{tt.push(r)}},React.createElement(et,{style:U.icon,source:a("settings")})))}))}var{FormInput:ot,FormRow:fe,FormText:rt}=m,Ne=y.createThemedStyleSheet({disclaimer:{backgroundColor:y.ThemeColorMap.BACKGROUND_SECONDARY,padding:10},disclaimerText:{textAlign:"center"}});function ue(){let[e,t]=React.useState(""),[o,r]=React.useState(F);return React.createElement(React.Fragment,null,React.createElement(ot,{value:e,onChange:n=>t(n),title:"PLUGIN URL"}),React.createElement(fe,{label:"Install plugin",leading:()=>React.createElement(fe.Icon,{source:a("add_white")}),trailing:fe.Arrow,onPress:()=>{De(e).then(()=>{t(""),r(F)}).catch(n=>{h(n.message,a("Small"))})}}),React.createElement(d.FlatList,{data:Object.values(o),renderItem:({item:n})=>React.createElement(me,{plugin:n}),keyExtractor:n=>n.id}),React.createElement(d.View,{style:Ne.disclaimer},React.createElement(rt,{style:Ne.disclaimerText},"Plugins are currently non-permanent whilst I find a storage solution.")))}var{FormRow:nt}=m,st=y.createThemedStyleSheet({asset:{width:32,height:32}});function ge({asset:e}){return React.createElement(nt,{label:`${e.name} - ${e.id}`,trailing:()=>React.createElement(d.Image,{source:e.id,style:st.asset}),onPress:()=>{v(e.name),h("Copied asset name to clipboard.",a("toast_copy_link"))}})}var{FormInput:it}=m;function ye(){let[e,t]=React.useState("");return React.createElement(React.Fragment,null,React.createElement(it,{value:e,onChange:o=>t(o),title:"SEARCH"}),React.createElement(d.FlatList,{data:Object.values(x).filter(o=>o.name.includes(e)),renderItem:({item:o})=>React.createElement(ge,{asset:o}),keyExtractor:o=>o.name}))}var at=_("getScreens",!1),lt=_("UserSettingsOverviewWrapper",!1);function he(){w("default",at,(e,t)=>({...t,VendettaSettings:{title:"Vendetta",render:pe},VendettaPlugins:{title:"Plugins",render:ue},VendettaAssetBrowser:{title:"Asset Browser",render:ye}})),w("default",lt,(e,t)=>{let o=O(t.props.children,r=>r.type&&r.type.name==="UserSettingsOverview");w("renderSupportAndAcknowledgements",o.type.prototype,(r,{props:{children:n}})=>{let i=n.findIndex(c=>c?.type?.name==="UploadLogsButton");i!==-1&&n.splice(i,1)}),w("render",o.type.prototype,(r,{props:{children:n}})=>{let i=[V.Messages.BILLING_SETTINGS,V.Messages.PREMIUM_SETTINGS],c=n.findIndex(s=>i.includes(s.props.title));n.splice(c===-1?4:c,0,React.createElement(se,{navigation:o.props.navigation}))})},!0)}console.log("Hello from Vendetta!");async function ct(){let e=!1;try{window.vendetta={patcher:xe,metro:{...K,common:{...Z}},constants:{...X},utils:{copyText:v,findInReactTree:O,findInTree:N},debug:{connectToDebugger:C},ui:{components:{...te},toasts:{...oe},assets:{all:x,find:Ie,getAssetByID:ve,getAssetByName:Pe,getAssetIDByName:a}},logger:S},he(),ne(),Te()}catch(t){e=!0,alert(`Vendetta failed to initialize...
${t.stack||t.toString()}`)}e||S.log("Vendetta is ready!")}ct();})();
//# sourceURL=Vendetta